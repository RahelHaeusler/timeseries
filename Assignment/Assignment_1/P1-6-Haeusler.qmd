---
title: "P1-6-Haeusler"
author: "Rahel Häusler"
date: 10.04.2024 (deadline)
format: html
toc: true
editor: visual
warning: false
error: false
---

## Preliminaries

```{r}
install.packages("data.table")
install.packages("dplyr")
library(data.table)
library(dplyr)
LCdata <- fread("LCdata.csv")
set.seed(6)
myLCdata <- LCdata %>% sample(5) %>% slice_sample(prop = .5)

```

# Task 1

## Task Description:

Use dplyr::glimpse() and str() to get a first impression of your data set. Download the data dictionary from Moodle, find the attributes that are present in your data set myLCdata and read the corresponding descriptions. **Try to understand their meaning in the context of peer-to-peer (P2P) loans**.

```{r}
# Get a glimpse of the dataset
glimpse(myLCdata)

# Use str() function to get structure of the dataset
str(myLCdata)


```

+----------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Variable       | Description                                                                                                                                                                                                               | Meaning for P2P Loans                                                                                                                                                                                                                                                                                                                                     |
+================+===========================================================================================================================================================================================================================+===========================================================================================================================================================================================================================================================================================================================================================+
| inq_last_6mths | The number of inquiries in past 6 months (excluding auto and mortgage inquiries)                                                                                                                                          | The number of inquiries helps the lender to evaluate the credit worthiness and credit trustness of the borrower (e.g. may indicate overspending –\> risk of credit default)                                                                                                                                                                               |
+----------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| pub_rec        | Number of derogatory public records.                                                                                                                                                                                      | The number of derogatory public records helps the lender to assess the credit worthiness of the borrower. Furthermore, public records may be used for risk and compliance assessment of the borrower.                                                                                                                                                     |
+----------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| revol_bal      | Total credit revolving balance.\                                                                                                                                                                                          | Revolving balance have to be considered in the creditworthiness assessment. The credit line has to be considered in the debit utilization ratio which influences the risk evaluation of the loan and therefore directly impacts the interest rate. Moreover, the credit revolving balance can help to understand the financial stability of the borrower. |
|                | A revolving credit is a credit line that remains available even as you pay the balance. Borrowers can access credit up to a certain amount and then have ongoing access to that amount of credit. Typically a credit card |                                                                                                                                                                                                                                                                                                                                                           |
+----------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| dti            | A ratio calculated using the borrower’s total monthly debt payments on the total debt obligations (excluding mortgage and the requested LC loan), divided by the borrower’s self-reported monthly income.                 | The dti is a measurement that helps lenders to assess the borrower's ability to manage their debt payment relative to their income. It provides a measure of the borrower's financial health and ability to repay their loan.                                                                                                                             |
+----------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| home_ownership | The home ownership status provided by the borrower during registration. Our values are: RENT, OWN, MORTGAGE, OTHER.                                                                                                       | The home ownership status can provide insights into the financial stability and responsibility of the borrower.                                                                                                                                                                                                                                           |
+----------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

: Extract of LC_DataDictionary

# Task 2

## Task Description:

Use summary() and skimr::skim() to review the main statistical metrics of your attributes. What do they tell you about the attributes? **Interpret them not only statistically, but also in the domain context**.

```{r}
library(skimr)
# Review main statistical metrics using summary()
summary(myLCdata)

# Review main statistical metrics using skim()
skim(myLCdata)
```

# Task 3

## Task Description:

**Choose at least one suitable diagram type (e.g. a histogram, a scatterplot) for each of the 5 attributes in your data set and visualize it using ggplot2**. **Give your plots a professional look (e.g., add a title, make the axes labels readable, add the measurement units if available).**

**Interpret each of your plots:**

• What information can you read off the diagram type you chose (e.g. in a histogram you can read off range, distribution, etc.)?

• What does it tell you about the attribute in the context of the attribute semantic and domain? Does it confirm your first assumptions about the attribute from task 2?

```{r}
library(ggplot2)

hist(myLCdata$inq_last_6m,
     main = "Histogram of Inquiries in Last 6 Months",
     xlab = "Number of Inquiries",
     ylab = "Frequency",
     col = "skyblue",
     border = "black",
     xlim = c(0, 8))

# Create a frequency distribution with binwidth=1 for pub_rec
ggplot(myLCdata, aes(x = pub_rec)) +
  geom_histogram(binwidth = 1, fill = "skyblue", color = "black",
                 breaks = hist_range) +
  labs(title = "Frequency Distribution of Public Records",
       x = "Number of Public Records",
       y = "Frequency",
       subtitle = paste("There are values which are outside the defined range")) +
  scale_x_continuous(breaks = hist_range)

# Create a scatterplot for pub_rec
plot(seq_along(myLCdata$pub_rec), myLCdata$pub_rec,
     main = "Scatterplot of Public Records",
     xlab = "Observation Number",
     ylab = "Number of Public Records")

# Create a histogram for revol_bal
hist(myLCdata$revol_bal,
     main = "Histogram of total credit revolving balance",
     xlab = "Total credit revolving balance",
     ylab = "Frequency",
     col = "skyblue",
     border = "black",
     xlim = c(0, 300000))

# Create a scatterplot for revol_bal
plot(seq_along(myLCdata$revol_bal), myLCdata$revol_bal,
     main = "Scatterplot of Revolving Balance",
     xlab = "Observation Number",
     ylab = "Revolving Balance")

# Create a histogram for dti
hist(myLCdata$dti,
     main = "Histogram of Debt-to-Income Ratio (dti)",
     xlab = "Debt-to-Income Ratio (dti)",
     ylab = "Frequency",
     col = "skyblue",
     border = "black")

# Create a boxplot for dti
boxplot(myLCdata$dti,
        main = "Boxplot of Debt-to-Income Ratio (dti)",
        ylab = "Debt-to-Income Ratio (dti)")

# Convert home_ownership to factor 
myLCdata$home_ownership <- factor(myLCdata$home_ownership, levels = c("RENT", "OWN", "MORTGAGE", "OTHER"))

# Compute the frequency count of each category
frequency <- table(myLCdata$home_ownership)

# Create a bar plot for home_ownership
bp <- barplot(frequency,
              main = "Frequency of Home Ownership",
              xlab = "Home Ownership",
              ylab = "Frequency",
              col = "skyblue",
              ylim = c(0, max(frequency) * 1.2))  # Adjust the y-axis limit

# Add text labels for numeric values
text(x = bp,
     y = frequency + 1,
     labels = frequency,
     pos = 3, cex = 0.8, col = "black")

```

# Task 4

## Task Description:

In task 3, you looked at each variable separately. Now the goal is to see if there are some obvious correlations or patterns when looking at pairs of variables.

```{r}
# Create a box plot of revol_bal grouped by home_ownership
boxplot(revol_bal ~ home_ownership, data = myLCdata,
        main = "Boxplot of Revolving Balance by Home Ownership",
        xlab = "Home Ownership",
        ylab = "Revolving Balance",
        col = "skyblue")

# Calculate the correlation between revol_bal and dti
correlation <- cor(myLCdata$revol_bal, myLCdata$dti)

# Create a scatterplot of dti against revol_bal
plot(myLCdata$dti, myLCdata$revol_bal,
     main = "Scatterplot of Debt-to-Income Ratio vs. Revolving Balance",
     sub = paste("Correlation =", round(correlation, 2)),
     xlab = "Debt-to-Income Ratio",
     ylab = "Revolving Balance",
     col = "blue")

# Add correlation coefficient to the plot
text(x = min(myLCdata$dti), 
     y = max(myLCdata$revol_bal),
     labels = paste("Correlation =", round(correlation, 2)),
     pos = 4, cex = 0.8, col = "black")


# Exclude rows with missing values in inq_last_6mths and pub_rec
complete_cases <- complete.cases(myLCdata$inq_last_6mths, myLCdata$pub_rec)
inq_last_6mths <- myLCdata$inq_last_6mths[complete_cases]
pub_rec <- myLCdata$pub_rec[complete_cases]

# Calculate the correlation between inq_last_6mths and pub_rec
correlation_2 <- cor(inq_last_6mths, pub_rec)

# Create a scatterplot of pub_rec against inq_last_6mths
plot(inq_last_6mths, pub_rec,
     main = "Scatterplot of Inquiries in Last 6 Months vs. Public Records",
     sub = paste("Correlation =", round(correlation_2, 2)),
     xlab = "Inquiries in Last 6 Months",
     ylab = "Public Records",
     col = "blue")


# Exclude rows with missing values in dti and inq_last_6mths
complete_cases <- complete.cases(myLCdata$dti, myLCdata$inq_last_6mths)
dti <- myLCdata$dti[complete_cases]
inq_last_6mths <- myLCdata$inq_last_6mths[complete_cases]

# Calculate the correlation between dti and inq_last_6mths
correlation_3 <- cor(dti, inq_last_6mths)

# Create a scatterplot of dti against inq_last_6mths
plot(inq_last_6mths, dti,
     main = "Scatterplot of Debt-to-Income Ratio vs. Inquiries in Last 6 Months",
     sub = paste("Correlation =", round(correlation_3, 2)),
     xlab = "Inquiries in Last 6 Months",
     ylab = "Debt-to-Income Ratio",
     col = "blue")

# Convert home_ownership to factor if it's not already
myLCdata$home_ownership <- factor(myLCdata$home_ownership)

# Create a matrix of scatterplots
pairs(~ inq_last_6mths + pub_rec + revol_bal + dti + home_ownership, data = myLCdata,
      main = "Scatterplot Matrix")



```

**Add Text**
